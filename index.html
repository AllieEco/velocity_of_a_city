<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gestion Agile - Planning Projet</title>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;900&family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <!-- Tailwind CSS CDN + config custom -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              sans: ['Inter', 'sans-serif'],
              display: ['Montserrat', 'sans-serif'],
            },
            colors: {
              primary: '#7C3AED', // violet
              accent: '#38BDF8', // bleu
              gold: '#FFD700',
              dark: '#18181B',
            },
            boxShadow: {
              magic: '0 8px 32px 0 rgba(124,58,237,0.25)',
            },
          },
        },
      }
    </script>
    <!-- Heroicons -->
    <script src="https://unpkg.com/heroicons@2.0.13/dist/heroicons.min.js"></script>
    <!-- React & ReactDOM CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel pour JSX inline -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- jsPDF pour g√©n√©ration de PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
      body {
        font-family: 'Inter', sans-serif;
        background: linear-gradient(135deg, #f3e8ff 0%, #f9fafb 100%);
        min-height: 100vh;
      }
      
      /* Force les modals au-dessus de tout */
      .modal-overlay {
        z-index: 999999 !important;
        position: fixed !important;
        top: 0 !important;
        left: 0 !important;
        right: 0 !important;
        bottom: 0 !important;
        background-color: rgba(0, 0, 0, 0.8) !important;
        backdrop-filter: blur(10px) !important;
        -webkit-backdrop-filter: blur(10px) !important;
      }
      
      .modal-content {
        z-index: 1000000 !important;
        position: relative !important;
        background: white !important;
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25) !important;
      }
      .fade-in {
        animation: fadeIn 1s cubic-bezier(.39,.575,.565,1) both;
      }
      @keyframes fadeIn {
        0% { opacity: 0; transform: translateY(30px); }
        100% { opacity: 1; transform: none; }
      }
    </style>
  </head>
  <body class="bg-gradient-to-br from-primary/10 via-accent/10 to-white min-h-screen relative">
    <!-- Header -->
    <header class="w-full py-6 px-4 bg-white/80 backdrop-blur shadow-md fixed top-0 left-0 z-20 fade-in">
      <div class="max-w-7xl mx-auto flex items-center gap-4">
        <span class="inline-block bg-primary rounded-full p-2 shadow-lg">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="white" class="w-8 h-8">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6l4 2" />
            <circle cx="12" cy="12" r="10" stroke="white" stroke-width="2" fill="#7C3AED" />
          </svg>
        </span>
        <div>
          <h1 class="text-3xl font-extrabold font-display text-primary tracking-tight">Gestion Agile</h1>
          <div class="text-sm text-gray-500 font-semibold">Le planning qui fait r√™ver les chefs de projet ‚ú®</div>
        </div>
        <a href="dashboard.html" class="ml-auto px-5 py-2 rounded-lg font-bold text-white bg-accent hover:bg-primary transition shadow">Dashboard</a>
      </div>
    </header>
    <!-- Main -->
    <main class="max-w-7xl mx-auto pt-32 pb-16 px-2 fade-in">
      <div id="root"></div>
    </main>
    <!-- Footer -->
    <footer class="w-full py-6 px-4 bg-white/80 backdrop-blur shadow-inner fixed bottom-0 left-0 z-10 fade-in">
      <div class="max-w-7xl mx-auto flex items-center justify-between text-sm text-gray-500">
        <span>¬© <span id="year"></span> <span class="font-bold text-primary">Velocity of a City</span></span>
        <span>Fait avec <span class="text-accent">‚ô•</span> et beaucoup de <span class="text-gold">chocolat</span> !</span>
      </div>
    </footer>
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        const yearSpan = document.getElementById('year');
        if (yearSpan) yearSpan.textContent = new Date().getFullYear();
      });
    </script>
    <script type="text/babel">
      // Composant principal
      function App() {
        // === 1. Constantes ===
        const SPRINT_DAYS = 10; // Dur√©e d'un sprint en jours ouvr√©s
        const POINTS_PAR_STATUT = {
          'D√©butant': 30,
          'Junior': 45,
          'Confirm√©': 60,
          'Senior': 75,
        };

        // === 2. Structures de donn√©es ===
        // LocalStorage helpers
        function loadLS(key, def) {
          try {
            return JSON.parse(localStorage.getItem(key)) || def;
          } catch {
            return def;
          }
        }
        function saveLS(key, val) {
          localStorage.setItem(key, JSON.stringify(val));
        }

        // Chargement initial depuis localStorage
        const [devs, setDevs] = React.useState(() => loadLS('devs', []));
        const [projects, setProjects] = React.useState(() => loadLS('projects', []).map(p => ({...p, fini: p.fini ?? false, statut: p.statut || 'conception'})));
        const [sprints, setSprints] = React.useState(() => loadLS('sprints', []));

        // Statuts de projet avec leurs couleurs
        const STATUTS_PROJET = {
          'conception': { color: 'bg-indigo-100 text-indigo-800 border-indigo-200', icon: 'üé®', label: 'Conception' },
          'dev': { color: 'bg-blue-100 text-blue-800 border-blue-200', icon: 'üíª', label: 'D√©veloppement' },
          'test': { color: 'bg-yellow-100 text-yellow-800 border-yellow-200', icon: 'üß™', label: 'Test' },
          'review': { color: 'bg-purple-100 text-purple-800 border-purple-200', icon: 'üëÄ', label: 'Review' },
          'deploy': { color: 'bg-green-100 text-green-800 border-green-200', icon: 'üöÄ', label: 'D√©ploiement' }
        };

        // Sauvegarde √† chaque modification
        React.useEffect(() => { saveLS('devs', devs); }, [devs]);
        React.useEffect(() => { saveLS('projects', projects); }, [projects]);
        React.useEffect(() => { saveLS('sprints', sprints); }, [sprints]);

        // √âtat des modales au niveau racine
        const [modalOpen, setModalOpen] = React.useState(false);
        const [modalTarget, setModalTarget] = React.useState(null); // {id, fini}
        const [modalDate, setModalDate] = React.useState("");
        const [modalCompteRenduOpen, setModalCompteRenduOpen] = React.useState(false);
        const [projetPourCompteRendu, setProjetPourCompteRendu] = React.useState(null);

        // absences: { [sprintIndex]: nbJours }

        // === 3. Fonctions utilitaires ===

        // Fonctions de gestion des modales
        function handleToggleFini(projId) {
          const proj = projects.find(p => p.id === projId);
          if (!proj) return;
          
          if (!proj.fini) {
            // Si on marque comme fini, ouvrir la modal de compte rendu
            setProjetPourCompteRendu(proj);
            setModalCompteRenduOpen(true);
          } else {
            // Si on remet en non fini, utiliser l'ancienne modal
            setModalTarget({ id: projId, fini: proj.fini });
            setModalDate("");
            setModalOpen(true);
          }
        }

        function handleCompteRenduConfirm(compteRenduData) {
          if (projetPourCompteRendu) {
            // Marquer le projet comme fini
            setProjects(projects => projects.map(p => {
              if (p.id === projetPourCompteRendu.id) {
                const planning = genererPlanning(devs, projects);
                const planProj = planning.find(pl => pl.id === p.id);
                return { 
                  ...p, 
                  fini: true, 
                  statut: 'deploy',
                  dateFin: compteRenduData.dateRendu, 
                  sprints: planProj ? planProj.sprints : p.sprints 
                };
              }
              return p;
            }));

            // Cr√©er le compte rendu automatique
            const nouveauCompteRendu = {
              id: Date.now(),
              projetId: projetPourCompteRendu.id,
              projetNom: projetPourCompteRendu.nom,
              titre: `Compte rendu final - ${projetPourCompteRendu.nom}`,
              contenu: `R√âSUM√â DU PROJET:\n${compteRenduData.resume}\n\nCE QUI A MARCH√â:\n${compteRenduData.ceQuiAMarche}\n\nCE QUI A MOINS BIEN MARCH√â:\n${compteRenduData.ceQuiAMoinsMarche}\n\nAM√âLIORATIONS √Ä APPORTER:\n${compteRenduData.ameliorations}`,
              date: compteRenduData.dateRendu,
              type: 'livraison',
              isCompteRenduFinal: true,
              compteRenduData: compteRenduData
            };

            // Ajouter au localStorage des comptes rendus
            const compteRendusExistants = JSON.parse(localStorage.getItem('compteRendus') || '[]');
            compteRendusExistants.push(nouveauCompteRendu);
            localStorage.setItem('compteRendus', JSON.stringify(compteRendusExistants));

            // Forcer la mise √† jour du composant CompteRenduProjet
            if (window.addCompteRendu) {
              window.addCompteRendu(nouveauCompteRendu);
            }
          }
          
          setModalCompteRenduOpen(false);
          setProjetPourCompteRendu(null);
        }

        function handleCompteRenduClose() {
          setModalCompteRenduOpen(false);
          setProjetPourCompteRendu(null);
        }

        function handleModalConfirm() {
          if (modalTarget) {
            setProjects(projects => projects.map(p => {
              if (p.id === modalTarget.id) {
                // Si on marque comme fini, on enregistre la date de livraison ET le nombre de sprints n√©cessaires
                if (!modalTarget.fini && modalDate) {
                  // On r√©cup√®re le planning courant pour ce projet
                  const planning = genererPlanning(devs, projects);
                  const planProj = planning.find(pl => pl.id === p.id);
                  return { ...p, fini: true, dateFin: modalDate, sprints: planProj ? planProj.sprints : p.sprints };
                }
                // Si on remet en non fini, on efface la date de livraison et le champ sprints
                if (modalTarget.fini) {
                  const { dateFin, sprints, ...rest } = p;
                  return { ...rest, fini: false, statut: p.statut === 'deploy' ? 'review' : p.statut };
                }
              }
              return p;
            }));
          }
          setModalOpen(false);
          setModalTarget(null);
          setModalDate("");
        }

        function handleModalClose() {
          setModalOpen(false);
          setModalTarget(null);
          setModalDate("");
        }

        // Calcule les points disponibles pour un dev sur un sprint donn√©
        function getPointsDispo(dev, sprintIndex) {
          const base = POINTS_PAR_STATUT[dev.statut] || 0;
          const absenceData = dev.absences?.[sprintIndex];
          const abs = typeof absenceData === 'number' ? absenceData : (absenceData?.jours || 0);
          const ratio = Math.max(0, 1 - abs / SPRINT_DAYS);
          return Math.round(base * ratio);
        }

        // Calcule la capacit√© totale de l'√©quipe pour un sprint donn√©
        function getCapaciteSprint(devs, sprintIndex) {
          return devs.reduce((sum, dev) => sum + getPointsDispo(dev, sprintIndex), 0);
        }

        // R√©partition automatique des projets sur les sprints et les devs
        function genererPlanning(devs, projects) {
          // Tri des projets par priorit√© croissante
          const projetsTries = [...projects].sort((a, b) => a.priorite - b.priorite);
          let sprintIndex = 0;
          let projetsRestants = projetsTries.map(p => ({ ...p, pointsRestants: p.points, debut: null, fin: null, sprints: 0, devsAffectes: [] }));

          // On boucle tant qu'il reste des projets √† finir
          while (projetsRestants.some(p => p.pointsRestants > 0)) {
            // R√©initialiser les points disponibles pour ce sprint
            let devsState = devs.map(dev => ({
              ...dev,
              pointsDispo: getPointsDispo(dev, sprintIndex)
            }));

            // Premi√®re passe : identifier tous les projets actifs ce sprint
            let projetsActifs = projetsRestants.filter(p => p.pointsRestants > 0);
            
            // Deuxi√®me passe : r√©partition intelligente bas√©e sur les priorit√©s
            for (let projet of projetsActifs) {
              if (projet.pointsRestants <= 0) continue;
              if (projet.debut === null) projet.debut = sprintIndex;
              let pointsAffectes = 0;
              
              // D√©terminer les devs √† utiliser pour ce projet
              let devsPourProjet = Array.isArray(projet.devsAffectesIds) && projet.devsAffectesIds.length > 0
                ? devsState.filter(d => projet.devsAffectesIds.includes(d.id))
                : devsState;
              
              // R√©partition intelligente sur les devs affect√©s
              for (let dev of devsPourProjet) {
                if (dev.pointsDispo <= 0 || projet.pointsRestants <= 0) continue;
                
                // Identifier tous les projets actifs sur ce dev
                let projetsSurCeDev = projetsActifs.filter(p => {
                  if (p.pointsRestants <= 0) return false;
                  let devsDuProjet = Array.isArray(p.devsAffectesIds) && p.devsAffectesIds.length > 0
                    ? devsState.filter(d => p.devsAffectesIds.includes(d.id))
                    : devsState;
                  return devsDuProjet.some(d => d.id === dev.id);
                });
                
                // Grouper les projets par priorit√©
                let projetsParPriorite = {};
                projetsSurCeDev.forEach(p => {
                  if (!projetsParPriorite[p.priorite]) {
                    projetsParPriorite[p.priorite] = [];
                  }
                  projetsParPriorite[p.priorite].push(p);
                });
                
                let pointsPourCeDev = 0;
                const priorites = Object.keys(projetsParPriorite).map(Number).sort((a, b) => a - b);
                
                // Logique de r√©partition bas√©e sur les priorit√©s
                if (priorites.length === 1) {
                  // M√™me priorit√© : r√©partition √©quitable
                  const nbProjets = projetsParPriorite[priorites[0]].length;
                  pointsPourCeDev = Math.floor(dev.pointsDispo / nbProjets);
                } else if (priorites.length === 2) {
                  const prioriteHaute = priorites[0];
                  const prioriteBasse = priorites[1];
                  
                  if (prioriteHaute === 1 && prioriteBasse === 3) {
                    // Priorit√© 1 vs 3 : s√©quentiel (priorit√© 1 d'abord)
                    if (projet.priorite === 1) {
                      pointsPourCeDev = dev.pointsDispo; // 100% pour priorit√© 1
                    } else {
                      pointsPourCeDev = 0; // 0% pour priorit√© 3 (attendre)
                    }
                  } else {
                    // Autres cas : 80/20
                    if (projet.priorite === prioriteHaute) {
                      pointsPourCeDev = Math.floor(dev.pointsDispo * 0.8);
                    } else {
                      pointsPourCeDev = Math.floor(dev.pointsDispo * 0.2);
                    }
                  }
                } else {
                  // Plus de 2 priorit√©s : priorit√© la plus haute d'abord
                  const prioriteMin = Math.min(...priorites);
                  if (projet.priorite === prioriteMin) {
                    pointsPourCeDev = dev.pointsDispo; // 100% pour priorit√© la plus haute
                  } else {
                    pointsPourCeDev = 0; // 0% pour les autres (attendre)
                  }
                }
                
                // Appliquer les limites
                pointsPourCeDev = Math.min(pointsPourCeDev, projet.pointsRestants, dev.pointsDispo);
                
                dev.pointsDispo -= pointsPourCeDev;
                projet.pointsRestants -= pointsPourCeDev;
                pointsAffectes += pointsPourCeDev;
                if (!projet.devsAffectes.includes(dev.nom)) projet.devsAffectes.push(dev.nom);
              }
              
              if (pointsAffectes > 0) projet.sprints++;
              if (projet.pointsRestants <= 0 && projet.fin === null) projet.fin = sprintIndex;
            }
            sprintIndex++;
          }
          
          // Ajout d'une marge de 1 sprint par projet
          for (let projet of projetsRestants) {
            projet.sprints += 1;
            projet.fin = (projet.fin ?? 0) + 1;
          }
          return projetsRestants;
        }

        // === 4. Exemple d'utilisation (sera remplac√© par l'UI) ===
        // const planning = genererPlanning(devs, projects);

        return (
          <>
            <div className="space-y-12">
              <section className="fade-in">
                <SprintCalendar sprints={sprints} setSprints={setSprints} />
              </section>
              <section className="fade-in">
                <DevInput devs={devs} setDevs={setDevs} POINTS_PAR_STATUT={POINTS_PAR_STATUT} />
              </section>
              <section className="fade-in">
                <ProjectInput projects={projects} setProjects={setProjects} devs={devs} STATUTS_PROJET={STATUTS_PROJET} />
              </section>
              <section className="fade-in">
                <SprintConfig devs={devs} setDevs={setDevs} sprints={sprints} />
              </section>
              <section className="fade-in">
                <PlanningView 
                  devs={devs} 
                  projects={projects} 
                  genererPlanning={genererPlanning} 
                  setProjects={setProjects} 
                  STATUTS_PROJET={STATUTS_PROJET}
                  onToggleFini={handleToggleFini}
                />
              </section>
              <section className="fade-in">
                <CompteRenduProjet 
                  projects={projects} 
                  devs={devs} 
                  STATUTS_PROJET={STATUTS_PROJET}
                  onCompteRenduAdded={(nouveauCompteRendu) => {
                    // Cette fonction sera appel√©e quand un nouveau compte rendu est ajout√©
                    // Elle permettra de forcer la mise √† jour du composant
                  }}
                />
              </section>
            </div>
            
            {/* Modales au niveau racine */}
            <Modal
              open={modalOpen}
              onClose={handleModalClose}
              onConfirm={handleModalConfirm}
              message={modalTarget && (modalTarget.fini ? 'Marquer ce projet comme non fini ?' : 'Marquer ce projet comme fini ?')}
              requireDate={modalTarget && !modalTarget.fini}
              dateValue={modalDate}
              onDateChange={setModalDate}
            />
            <ModalCompteRendu
              open={modalCompteRenduOpen}
              onClose={handleCompteRenduClose}
              onConfirm={handleCompteRenduConfirm}
              projet={projetPourCompteRendu}
              STATUTS_PROJET={STATUTS_PROJET}
            />
          </>
        );
      }

      // Saisie des d√©veloppeurs
      function DevInput({ devs, setDevs, POINTS_PAR_STATUT }) {
        const [nom, setNom] = React.useState("");
        const [prenom, setPrenom] = React.useState("");
        const [statut, setStatut] = React.useState("D√©butant");
        const [editMode, setEditMode] = React.useState(false);
        const [editId, setEditId] = React.useState(null);

        // Points auto selon le statut
        const points = POINTS_PAR_STATUT[statut] || 0;

        function handleSubmit(e) {
          e.preventDefault();
          if (!nom.trim() || !prenom.trim()) return;
          if (editMode && editId !== null) {
            setDevs(devs => devs.map(dev =>
              dev.id === editId
                ? { ...dev, nom: nom.trim(), prenom: prenom.trim(), statut }
                : dev
            ));
            setEditMode(false);
            setEditId(null);
          } else {
            setDevs(devs => [
              ...devs,
              {
                id: Date.now(),
                nom: nom.trim(),
                prenom: prenom.trim(),
                statut,
                absences: {},
              },
            ]);
          }
          setNom("");
          setPrenom("");
          setStatut("D√©butant");
        }

        function handleEdit(dev) {
          setNom(dev.nom);
          setPrenom(dev.prenom);
          setStatut(dev.statut);
          setEditMode(true);
          setEditId(dev.id);
        }

        function handleCancelEdit() {
          setEditMode(false);
          setEditId(null);
          setNom("");
          setPrenom("");
          setStatut("D√©butant");
        }

        function handleDelete(devId) {
          if (window.confirm('Supprimer ce d√©veloppeur ?')) {
            setDevs(devs => devs.filter(dev => dev.id !== devId));
            if (editId === devId) {
              setEditMode(false);
              setEditId(null);
              setNom("");
              setPrenom("");
              setStatut("D√©butant");
            }
          }
        }

        return (
            <section className="bg-white/90 p-8 rounded-2xl shadow-magic border border-primary/10 mb-8 transition-all duration-300 hover:shadow-2xl">
              <h2 className="text-2xl font-bold font-display text-primary mb-4 flex items-center gap-2">
                <svg className="w-7 h-7 text-accent" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" d="M5.121 17.804A13.937 13.937 0 0112 15c2.5 0 4.847.655 6.879 1.804M15 10a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
                D√©veloppeurs
              </h2>
              <form className="flex flex-col md:flex-row md:items-end gap-4 mb-6" onSubmit={handleSubmit}>
                <div className="flex-1">
                  <label className="block text-sm font-semibold mb-1 text-gray-700">Pr√©nom</label>
                  <input type="text" className="w-full border-2 border-primary/20 rounded-lg px-3 py-2 focus:ring-2 focus:ring-primary/40 transition" value={prenom} onChange={e => setPrenom(e.target.value)} required />
                </div>
                <div className="flex-1">
                  <label className="block text-sm font-semibold mb-1 text-gray-700">Nom</label>
                  <input type="text" className="w-full border-2 border-primary/20 rounded-lg px-3 py-2 focus:ring-2 focus:ring-primary/40 transition" value={nom} onChange={e => setNom(e.target.value)} required />
                </div>
                <div>
                  <label className="block text-sm font-semibold mb-1 text-gray-700">Statut</label>
                  <select className="w-full border-2 border-primary/20 rounded-lg px-3 py-2 focus:ring-2 focus:ring-primary/40 transition" value={statut} onChange={e => setStatut(e.target.value)}>
                    {Object.keys(POINTS_PAR_STATUT).map(s => (
                      <option key={s} value={s}>{s}</option>
                    ))}
                  </select>
                </div>
                <div>
                  <label className="block text-sm font-semibold mb-1 text-gray-700">Points/sprint</label>
                  <input type="text" className="w-20 border-2 border-primary/10 rounded-lg px-3 py-2 bg-gray-100 text-center font-bold" value={points} readOnly />
                </div>
                <button type="submit" className={"px-5 py-2 rounded-lg font-bold text-white shadow transition-all duration-200 " + (editMode ? "bg-primary hover:bg-primary/90" : "bg-accent hover:bg-accent/80")}>{editMode ? "Modifier" : "Ajouter"}</button>
                {editMode && (
                  <button type="button" className="ml-2 px-4 py-2 rounded-lg font-semibold bg-gray-200 hover:bg-gray-300 text-gray-700 transition" onClick={handleCancelEdit}>Annuler</button>
                )}
              </form>
              <div>
                <h3 className="font-semibold mb-2 text-gray-700">Liste des d√©veloppeurs</h3>
                {devs.length === 0 ? (
                  <div className="text-gray-400 italic">Aucun d√©veloppeur saisi.</div>
                ) : (
                  <ul className="divide-y">
                    {devs.map(dev => (
                      <li key={dev.id} className="py-2 flex items-center gap-4 group">
                        <span className="font-medium text-dark">{dev.prenom} {dev.nom}</span>
                        <span className="text-sm text-primary font-semibold">{dev.statut}</span>
                        <span className="text-xs text-gray-400">{POINTS_PAR_STATUT[dev.statut]} pts/sprint</span>
                        <button type="button" className="ml-2 text-accent hover:text-primary font-bold opacity-70 group-hover:opacity-100 transition" title="Modifier" onClick={() => handleEdit(dev)}>
                          <svg className="w-5 h-5" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" d="M15.232 5.232l3.536 3.536M9 13l6-6M3 21h18" /></svg>
                        </button>
                        <button type="button" className="ml-2 text-red-400 hover:text-red-600 font-bold opacity-70 group-hover:opacity-100 transition" title="Supprimer" onClick={() => handleDelete(dev.id)}>
                          <svg className="w-5 h-5" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
                        </button>
                      </li>
                    ))}
                  </ul>
                )}
              </div>
            </section>
        );
      }

      // Saisie des projets
      function ProjectInput({ projects, setProjects, devs, STATUTS_PROJET }) {
        const [nom, setNom] = React.useState("");
        const [priorite, setPriorite] = React.useState(1);
        const [points, setPoints] = React.useState(0);
        const [dateDebut, setDateDebut] = React.useState("");
        const [statut, setStatut] = React.useState("conception");
        const [devsAffectesIds, setDevsAffectesIds] = React.useState([]);
        const [editMode, setEditMode] = React.useState(false);
        const [editId, setEditId] = React.useState(null);

        // Synchronise la s√©lection des devs affect√©s lors du passage en √©dition
        React.useEffect(() => {
          if (editMode && editId !== null) {
            const proj = projects.find(p => p.id === editId);
            setDevsAffectesIds(proj && proj.devsAffectesIds ? proj.devsAffectesIds : []);
            setDateDebut(proj && proj.dateDebut ? proj.dateDebut : "");
            setStatut(proj && proj.statut ? proj.statut : "conception");
          }
        }, [editMode, editId, projects]);

        // S√©lecteur custom multi-tags pour les devs
        const [showDropdown, setShowDropdown] = React.useState(false);
        const inputRef = React.useRef();
        const dropdownRef = React.useRef();

        function handleAddDev(devId) {
          if (!devsAffectesIds.includes(devId)) {
            setDevsAffectesIds(ids => [...ids, devId]);
          }
          setShowDropdown(false);
        }
        function handleRemoveDev(devId) {
          setDevsAffectesIds(ids => ids.filter(id => id !== devId));
        }
        function handleInputClick() {
          setShowDropdown(true);
          if (inputRef.current) inputRef.current.focus();
        }
        function handleBlur(e) {
          // Ferme le dropdown si on clique en dehors
          setTimeout(() => {
            if (!dropdownRef.current || !dropdownRef.current.contains(document.activeElement)) {
              setShowDropdown(false);
            }
          }, 150);
        }

        function handleSubmit(e) {
          e.preventDefault();
          if (!nom.trim() || !priorite || !points) return;
          if (editMode && editId !== null) {
            setProjects(projects => projects.map(proj =>
              proj.id === editId
                ? {
                    ...proj,
                    nom: nom.trim(),
                    priorite: Number(priorite),
                    points: Number(points),
                    statut: statut,
                    devsAffectesIds: devsAffectesIds.length > 0 ? devsAffectesIds : undefined,
                    dateDebut: dateDebut || undefined,
                    fini: proj.fini ?? false,
                  }
                : proj
            ));
            setEditMode(false);
            setEditId(null);
          } else {
            setProjects(projects => [
              ...projects,
              {
                id: Date.now(),
                nom: nom.trim(),
                priorite: Number(priorite),
                points: Number(points),
                statut: statut,
                devsAffectesIds: devsAffectesIds.length > 0 ? devsAffectesIds : undefined,
                dateDebut: dateDebut || undefined,
                fini: false,
              },
            ]);
          }
          setNom("");
          setPriorite(1);
          setPoints(0);
          setStatut("conception");
          setDevsAffectesIds([]);
          setDateDebut("");
        }

        function handleEdit(proj) {
          setNom(proj.nom);
          setPriorite(proj.priorite);
          setPoints(proj.points);
          setStatut(proj.statut || "conception");
          setEditMode(true);
          setEditId(proj.id);
        }

        function handleCancelEdit() {
          setEditMode(false);
          setEditId(null);
          setNom("");
          setPriorite(1);
          setPoints(0);
          setStatut("conception");
          setDevsAffectesIds([]);
          setDateDebut("");
        }

        function handleDelete(projId) {
          if (window.confirm('Supprimer ce projet ?')) {
            setProjects(projects => projects.filter(proj => proj.id !== projId));
            if (editId === projId) {
              setEditMode(false);
              setEditId(null);
              setNom("");
              setPriorite(1);
              setPoints(0);
              setStatut("conception");
              setDevsAffectesIds([]);
              setDateDebut("");
            }
          }
        }

        // Tri par priorit√© croissante
        const projetsTries = [...projects].sort((a, b) => a.priorite - b.priorite);

        return (
          <section className="bg-white/90 p-8 rounded-2xl shadow-magic border border-primary/10 mb-8 transition-all duration-300 hover:shadow-2xl">
            <h2 className="text-2xl font-bold font-display text-primary mb-4 flex items-center gap-2">
              <svg className="w-7 h-7 text-accent" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>
              Projets
            </h2>
            <form className="flex flex-col gap-2 mb-6" onSubmit={handleSubmit}>
              <div className="flex flex-col md:flex-row md:items-end gap-4">
                <div className="flex-1">
                  <label className="block text-sm font-semibold mb-1 text-gray-700">Nom du projet</label>
                  <input type="text" className="w-full border-2 border-primary/20 rounded-lg px-3 py-2 focus:ring-2 focus:ring-primary/40 transition h-10" value={nom} onChange={e => setNom(e.target.value)} required />
                </div>
                <div>
                  <label className="block text-sm font-semibold mb-1 text-gray-700">Statut</label>
                  <select className="w-44 border-2 border-primary/20 rounded-lg px-3 py-2 focus:ring-2 focus:ring-primary/40 transition h-10" value={statut} onChange={e => setStatut(e.target.value)} required>
                    {Object.keys(STATUTS_PROJET).map(status => (
                      <option key={status} value={status}>{STATUTS_PROJET[status].icon} {STATUTS_PROJET[status].label}</option>
                    ))}
                  </select>
                </div>
                <div>
                  <label className="block text-sm font-semibold mb-1 text-gray-700">Date de d√©but</label>
                  <input type="date" className="w-44 border-2 border-primary/20 rounded-lg px-3 py-2 focus:ring-2 focus:ring-primary/40 transition h-10" value={dateDebut} onChange={e => setDateDebut(e.target.value)} />
                </div>
                <div>
                  <label className="block text-sm font-semibold mb-1 text-gray-700">Priorit√©</label>
                  <input type="number" min="1" className="w-20 border-2 border-primary/20 rounded-lg px-3 py-2 focus:ring-2 focus:ring-primary/40 transition h-10" value={priorite} onChange={e => setPriorite(e.target.value)} required />
                </div>
                <div>
                  <label className="block text-sm font-semibold mb-1 text-gray-700">Points estim√©s</label>
                  <input type="number" min="1" className="w-24 border-2 border-primary/20 rounded-lg px-3 py-2 focus:ring-2 focus:ring-primary/40 transition h-10" value={points} onChange={e => setPoints(e.target.value)} required />
                </div>
                <button type="submit" className={"px-5 py-2 rounded-lg font-bold text-white shadow transition-all duration-200 " + (editMode ? "bg-primary hover:bg-primary/90" : "bg-green-600 hover:bg-green-700")}>{editMode ? "Modifier" : "Ajouter"}</button>
                {editMode && (
                  <button type="button" className="ml-2 px-4 py-2 rounded-lg font-semibold bg-gray-200 hover:bg-gray-300 text-gray-700 transition mt-6 md:mt-0" onClick={handleCancelEdit}>Annuler</button>
                )}
              </div>
              <div className="flex flex-col gap-1 mt-2">
                <label className="block text-sm font-semibold mb-1 text-gray-700">D√©veloppeurs affect√©s</label>
                <div className="flex gap-2 items-center relative">
                  <div
                    className="flex flex-wrap gap-1 border rounded px-2 py-0 bg-gray-50 h-10 min-h-[40px] cursor-pointer w-full items-center"
                    tabIndex={0}
                    ref={inputRef}
                    onClick={handleInputClick}
                    onBlur={handleBlur}
                    style={{overflowY: 'auto'}}
                  >
                    {devsAffectesIds.length === 0 && (
                      <span className="text-gray-400">Tous les devs</span>
                    )}
                    {devsAffectesIds.map(id => {
                      const dev = devs.find(d => d.id === id);
                      if (!dev) return null;
                      return (
                        <span key={id} className="bg-accent/20 text-accent rounded px-2 py-0.5 flex items-center gap-1">
                          {dev.prenom} {dev.nom}
                          <button type="button" className="ml-1 text-accent hover:text-primary font-bold" title="Retirer" onClick={e => { e.stopPropagation(); handleRemoveDev(id); }}>
                            √ó
                          </button>
                        </span>
                      );
                    })}
                  </div>
                  <button
                    type="button"
                    className="bg-accent/10 text-accent px-2 py-1 rounded border border-accent/20 hover:bg-accent/20 text-sm font-semibold h-10"
                    style={{ minWidth: '40px' }}
                    onClick={handleInputClick}
                  >
                    Ajouter un d√©veloppeur
                  </button>
                 {showDropdown && (
                   <div ref={dropdownRef} tabIndex={-1} className="absolute top-12 left-0 z-10 bg-white border border-primary/10 rounded-lg shadow-lg p-2 w-full max-h-48 overflow-y-auto animate-fade-in">
                     {devs.filter(d => !devsAffectesIds.includes(d.id)).length === 0 ? (
                       <div className="text-gray-400 px-2 py-1">Tous les d√©veloppeurs sont d√©j√† s√©lectionn√©s.</div>
                     ) : (
                       devs.filter(d => !devsAffectesIds.includes(d.id)).map(dev => (
                         <button
                           key={dev.id}
                           type="button"
                           className="block w-full text-left px-3 py-2 rounded hover:bg-accent/10 text-dark font-medium transition"
                           onClick={() => handleAddDev(dev.id)}
                         >
                           {dev.prenom} {dev.nom}
                         </button>
                       ))
                     )}
                   </div>
                 )}
                </div>
                <div className="text-xs text-gray-400 mt-1">(Aucun s√©lectionn√© = tous les devs)</div>
              </div>
            </form>
            <div>
              <h3 className="font-semibold mb-2 text-gray-700">Liste des projets</h3>
              {projetsTries.length === 0 ? (
                <div className="text-gray-400 italic">Aucun projet saisi.</div>
              ) : (
                <ul className="divide-y">
                  {projetsTries.map(proj => (
                    <li key={proj.id} className="py-2 flex flex-col md:flex-row md:items-center gap-2 md:gap-4">
                      <span className="font-medium text-dark">{proj.nom}</span>
                      <span className={`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-bold border ${STATUTS_PROJET[proj.statut || 'conception']?.color || STATUTS_PROJET['conception'].color}`}>
                        {STATUTS_PROJET[proj.statut || 'conception']?.icon || STATUTS_PROJET['conception'].icon} {STATUTS_PROJET[proj.statut || 'conception']?.label || STATUTS_PROJET['conception'].label}
                      </span>
                      <span className="text-sm text-primary font-semibold">Priorit√© {proj.priorite}</span>
                      <span className="text-xs text-gray-400">{proj.points} pts</span>
                      <span className="text-xs text-gray-500">{(proj.devsAffectesIds && proj.devsAffectesIds.length > 0)
                        ? devs.filter(d => proj.devsAffectesIds.includes(d.id)).map(d => d.prenom + ' ' + d.nom).join(', ')
                        : 'Tous les devs'}</span>
                      {proj.dateDebut && <span className="text-xs text-gray-400">D√©bute le {proj.dateDebut}</span>}
                      <button type="button" className="ml-2 text-accent hover:text-primary font-bold opacity-70 group-hover:opacity-100 transition" title="Modifier" onClick={() => handleEdit(proj)}>
                        <svg className="w-5 h-5" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>
                      </button>
                      <button type="button" className="ml-2 text-red-400 hover:text-red-600 font-bold opacity-70 group-hover:opacity-100 transition" title="Supprimer" onClick={() => handleDelete(proj.id)}>
                        <svg className="w-5 h-5" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
                      </button>
                    </li>
                  ))}
                </ul>
              )}
            </div>
          </section>
        );
      }

      // Saisie des indisponibilit√©s par sprint
      function SprintConfig({ devs, setDevs, sprints = [] }) {
        const [dateDebut, setDateDebut] = React.useState("");
        const [dateFin, setDateFin] = React.useState("");
        const [devId, setDevId] = React.useState("");
        const [typeAbsence, setTypeAbsence] = React.useState("Cong√©s");
        const [editMode, setEditMode] = React.useState(false);
        const [editTarget, setEditTarget] = React.useState(null); // {devId, dateDebut}

        // Types d'absence avec leurs couleurs
        const TYPES_ABSENCE = {
          'Cong√©s': { color: 'bg-blue-100 text-blue-800 border-blue-200', icon: 'üèñÔ∏è' },
          'Maladie': { color: 'bg-red-100 text-red-800 border-red-200', icon: 'üè•' },
          'Formation': { color: 'bg-purple-100 text-purple-800 border-purple-200', icon: 'üìö' },
          'D√©placement': { color: 'bg-orange-100 text-orange-800 border-orange-200', icon: '‚úàÔ∏è' },
          'Autre': { color: 'bg-gray-100 text-gray-800 border-gray-200', icon: 'üìã' }
        };

        // Points par statut (pour le calcul)
        const POINTS_PAR_STATUT = {
          'D√©butant': 30,
          'Junior': 45,
          'Confirm√©': 60,
          'Senior': 75,
        };
        const SPRINT_DAYS = 10;

        // Ajout ou modification d'une absence
        function handleSubmit(e) {
          e.preventDefault();
          if (!devId || !dateDebut || !dateFin || !typeAbsence) return;
          // Calculer le nombre de jours d'absence (date de fin incluse)
          const debut = new Date(dateDebut);
          const fin = new Date(dateFin);
          const diffTime = fin.getTime() - debut.getTime();
          const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1; // +1 car date de fin incluse
          
          setDevs(devs => devs.map(dev => {
            if (dev.id !== Number(devId)) return dev;
            return {
              ...dev,
              absences: {
                ...dev.absences,
                [dateDebut]: { jours: diffDays, type: typeAbsence }
              }
            };
          }));
          setDateDebut("");
          setDateFin("");
          setTypeAbsence("Cong√©s");
          setEditMode(false);
          setEditTarget(null);
          setDevId("");
        }

        // Suppression d'une absence
        function handleDeleteAbs(devIdToDel, dateDebutToDel) {
          setDevs(devs => devs.map(dev => {
            if (dev.id !== devIdToDel) return dev;
            const newAbs = { ...dev.absences };
            delete newAbs[dateDebutToDel];
            return { ...dev, absences: newAbs };
          }));
          // Si on √©tait en √©dition de cette absence, reset
          if (editTarget && editTarget.devId === devIdToDel && editTarget.dateDebut === dateDebutToDel) {
            setEditMode(false);
            setEditTarget(null);
            setDateDebut("");
            setDateFin("");
            setDevId("");
          }
        }

        // Pr√©-remplir le formulaire pour √©dition
        function handleEditAbs(devIdEdit, dateDebutEdit, absenceData) {
          setDevId(devIdEdit.toString());
          setDateDebut(dateDebutEdit);
          
          // G√©rer l'ancien format (nombre) et le nouveau format (objet)
          const nbJours = typeof absenceData === 'number' ? absenceData : absenceData.jours;
          const type = typeof absenceData === 'number' ? 'Cong√©s' : absenceData.type;
          
          setTypeAbsence(type);
          
          // Calculer la date de fin √† partir du nombre de jours
          const debut = new Date(dateDebutEdit);
          const fin = new Date(debut);
          fin.setDate(fin.getDate() + nbJours - 1); // -1 car date de fin incluse
          setDateFin(fin.toISOString().split('T')[0]);
          
          setEditMode(true);
          setEditTarget({ devId: devIdEdit, dateDebut: dateDebutEdit });
        }

        // Calcule les points restants pour un dev sur une date donn√©e
        function getPointsRestants(dev, dateDebut) {
          const base = POINTS_PAR_STATUT[dev.statut] || 0;
          const absenceData = dev.absences?.[dateDebut];
          const abs = typeof absenceData === 'number' ? absenceData : (absenceData?.jours || 0);
          const ratio = Math.max(0, 1 - abs / SPRINT_DAYS);
          return Math.round(base * ratio);
        }

        // Formatage date FR
        function formatDateFR(dateStr) {
          if (!dateStr) return "-";
          try {
            return new Date(dateStr).toLocaleDateString('fr-FR');
          } catch {
            return dateStr;
          }
        }

        return (
          <section className="bg-white/90 p-8 rounded-2xl shadow-magic border border-primary/10 mb-8 transition-all duration-300 hover:shadow-2xl">
            <h2 className="text-2xl font-bold font-display text-primary mb-4 flex items-center gap-2">
              <svg className="w-7 h-7 text-accent" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" /></svg>
              Indisponibilit√©s par date
            </h2>
            {devs.length === 0 ? (
              <div className="text-gray-400 italic">Ajoutez d'abord des d√©veloppeurs.</div>
            ) : (
              <>
                <form className="flex flex-col md:flex-row md:items-end gap-4 mb-6" onSubmit={handleSubmit}>
                  <div>
                    <label className="block text-sm font-semibold mb-1 text-gray-700">D√©veloppeur</label>
                    <select className="w-full border-2 border-primary/20 rounded-lg px-3 py-2 focus:ring-2 focus:ring-primary/40 transition h-10" value={devId} onChange={e => setDevId(e.target.value)} required>
                      <option value="">Choisir‚Ä¶</option>
                      {devs.map(dev => (
                        <option key={dev.id} value={dev.id}>{dev.prenom} {dev.nom}</option>
                      ))}
                    </select>
                  </div>
                  <div>
                    <label className="block text-sm font-semibold mb-1 text-gray-700">Type d'absence</label>
                    <select className="w-44 border-2 border-primary/20 rounded-lg px-3 py-2 focus:ring-2 focus:ring-primary/40 transition h-10" value={typeAbsence} onChange={e => setTypeAbsence(e.target.value)} required>
                      {Object.keys(TYPES_ABSENCE).map(type => (
                        <option key={type} value={type}>{TYPES_ABSENCE[type].icon} {type}</option>
                      ))}
                    </select>
                  </div>
                  <div>
                    <label className="block text-sm font-semibold mb-1 text-gray-700">Date de d√©but</label>
                    <input type="date" className="w-44 border-2 border-primary/20 rounded-lg px-3 py-2 focus:ring-2 focus:ring-primary/40 transition h-10" value={dateDebut} onChange={e => setDateDebut(e.target.value)} required />
                  </div>
                  <div>
                    <label className="block text-sm font-semibold mb-1 text-gray-700">Date de fin</label>
                    <input type="date" className="w-44 border-2 border-primary/20 rounded-lg px-3 py-2 focus:ring-2 focus:ring-primary/40 transition h-10" value={dateFin} onChange={e => setDateFin(e.target.value)} required />
                  </div>
                  <button type="submit" className={"px-5 py-2 rounded-lg font-bold text-white shadow transition-all duration-200 " + (editMode ? "bg-primary hover:bg-primary/90" : "bg-yellow-600 hover:bg-yellow-700")}>{editMode ? "Modifier" : "Enregistrer"}</button>
                  {editMode && (
                    <button type="button" className="ml-2 px-4 py-2 rounded-lg font-semibold bg-gray-200 hover:bg-gray-300 text-gray-700 transition" onClick={() => { setEditMode(false); setEditTarget(null); setDateDebut(""); setDateFin(""); setDevId(""); setTypeAbsence("Cong√©s"); }}>Annuler</button>
                  )}
                </form>
                <div>
                  <h3 className="font-semibold mb-2 text-gray-700">Synth√®se des absences</h3>
                  {devs.every(dev => !dev.absences || Object.keys(dev.absences).length === 0) ? (
                    <div className="text-gray-400 italic">Aucune absence saisie.</div>
                  ) : (
                    <ul className="divide-y">
                      {devs.map(dev => (
                        Object.keys(dev.absences || {}).length === 0 ? null : (
                          <li key={dev.id} className="py-2">
                            <span className="font-medium text-dark">{dev.prenom} {dev.nom} :</span>
                            {Object.entries(
                              Object.fromEntries(
                                Object.entries(dev.absences || {}).sort((a, b) => new Date(a[0]) - new Date(b[0]))
                              )
                            ).map(([date, absenceData]) => {
                              // G√©rer l'ancien format (nombre) et le nouveau format (objet)
                              const nbJours = typeof absenceData === 'number' ? absenceData : absenceData.jours;
                              const type = typeof absenceData === 'number' ? 'Cong√©s' : absenceData.type;
                              
                              // Trouver les n¬∞ de sprint(s) correspondant √† la p√©riode d'absence
                              let sprintsNums = [];
                              if (sprints && sprints.length > 0 && date) {
                                const dateDebutAbs = new Date(date);
                                const dateFinAbs = new Date(date);
                                dateFinAbs.setDate(dateFinAbs.getDate() + Number(nbJours) - 1);
                                sprints.forEach(s => {
                                  const sprintDeb = new Date(s.dateDebut);
                                  const sprintFin = new Date(s.dateFin);
                                  if (
                                    (dateDebutAbs <= sprintFin && dateDebutAbs >= sprintDeb) || // commence dans le sprint
                                    (dateFinAbs >= sprintDeb && dateFinAbs <= sprintFin) || // finit dans le sprint
                                    (dateDebutAbs <= sprintDeb && dateFinAbs >= sprintFin) // englobe le sprint
                                  ) {
                                    sprintsNums.push(s.numero);
                                  }
                                });
                              }
                              // Calculer la date de fin √† partir du nombre de jours
                              const dateDebutAbs = new Date(date);
                              const dateFinAbs = new Date(dateDebutAbs);
                              dateFinAbs.setDate(dateFinAbs.getDate() + Number(nbJours) - 1); // -1 car date de fin incluse
                              
                              return (
                                <span key={date} className="ml-2 text-sm text-primary font-semibold inline-flex items-center gap-1">
                                  <span className="inline-flex items-center gap-2">
                                    <span className={`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-bold border ${TYPES_ABSENCE[type]?.color || TYPES_ABSENCE['Autre'].color}`}>
                                      {TYPES_ABSENCE[type]?.icon || TYPES_ABSENCE['Autre'].icon} {type}
                                    </span>
                                    <span>
                                      Sprint {sprintsNums.length > 0 ? sprintsNums.join(', ') : '-'} : {formatDateFR(date)} ‚Üí {formatDateFR(dateFinAbs.toISOString().split('T')[0])} ({nbJours}j, {getPointsRestants(dev, date)} pts)
                                    </span>
                                  </span>
                                  <button type="button" className="ml-1 text-accent hover:text-primary font-bold opacity-70 group-hover:opacity-100 transition" title="Modifier" onClick={() => handleEditAbs(dev.id, date, absenceData)}>
                                    <svg className="w-5 h-5" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>
                                  </button>
                                  <button type="button" className="ml-1 text-red-400 hover:text-red-600 font-bold opacity-70 group-hover:opacity-100 transition" title="Supprimer" onClick={() => handleDeleteAbs(dev.id, date)}>
                                    <svg className="w-5 h-5" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
                                  </button>
                                </span>
                              );
                            })}
                          </li>
                        )
                      ))}
                    </ul>
                  )}
                </div>
              </>
            )}
          </section>
        );
      }

      // 1. Composant Modal
      function Modal({ open, onClose, onConfirm, message, requireDate, onDateChange, dateValue }) {
        if (!open) return null;
        return (
          <div 
            className="modal-overlay fixed inset-0 flex items-center justify-center" 
            style={{ 
              isolation: 'isolate'
            }}
            onClick={(e) => {
              if (e.target === e.currentTarget) {
                onClose();
              }
            }}
          >
            <div className="modal-content bg-white rounded-2xl shadow-2xl p-8 max-w-xs w-full text-center animate-fade-in">
              <div className="mb-6 text-lg font-semibold text-dark">{message}</div>
              {requireDate && (
                <div className="mb-4">
                  <label className="block text-sm font-semibold mb-1 text-gray-700">Date de livraison</label>
                  <input type="date" className="w-full border-2 border-primary/20 rounded-lg px-3 py-2 focus:ring-2 focus:ring-primary/40 transition" value={dateValue} onChange={e => onDateChange(e.target.value)} required />
                </div>
              )}
              <div className="flex justify-center gap-4">
                <button
                  className="px-5 py-2 rounded-lg font-bold text-white bg-green-500 hover:bg-green-600 transition"
                  onClick={onConfirm}
                  disabled={requireDate && !dateValue}
                  style={requireDate && !dateValue ? { opacity: 0.5, cursor: 'not-allowed' } : {}}
                >
                  Oui
                </button>
                <button
                  className="px-5 py-2 rounded-lg font-bold text-gray-700 bg-gray-200 hover:bg-gray-300 transition"
                  onClick={onClose}
                >
                  Annuler
                </button>
              </div>
            </div>
          </div>
        );
      }

      // 2. Composant Modal Compte Rendu
      function ModalCompteRendu({ open, onClose, onConfirm, projet, STATUTS_PROJET }) {
        const [resume, setResume] = React.useState("");
        const [ceQuiAMarche, setCeQuiAMarche] = React.useState("");
        const [ceQuiAMoinsMarche, setCeQuiAMoinsMarche] = React.useState("");
        const [ameliorations, setAmeliorations] = React.useState("");
        const [dateRendu, setDateRendu] = React.useState(new Date().toISOString().split('T')[0]);

        // R√©initialiser les champs quand la modal s'ouvre
        React.useEffect(() => {
          if (open && projet) {
            setResume("");
            setCeQuiAMarche("");
            setCeQuiAMoinsMarche("");
            setAmeliorations("");
            setDateRendu(new Date().toISOString().split('T')[0]);
          }
        }, [open, projet]);

        function handleConfirm() {
          if (!resume.trim() || !ceQuiAMarche.trim() || !ceQuiAMoinsMarche.trim() || !ameliorations.trim() || !dateRendu) {
            alert("Veuillez remplir tous les champs du compte rendu.");
            return;
          }
          onConfirm({
            resume: resume.trim(),
            ceQuiAMarche: ceQuiAMarche.trim(),
            ceQuiAMoinsMarche: ceQuiAMoinsMarche.trim(),
            ameliorations: ameliorations.trim(),
            dateRendu: dateRendu
          });
        }

        if (!open || !projet) return null;
        return (
          <div 
            className="modal-overlay fixed inset-0 flex items-center justify-center p-4" 
            style={{ 
              isolation: 'isolate'
            }}
            onClick={(e) => {
              if (e.target === e.currentTarget) {
                onClose();
              }
            }}
          >
            <div 
              className="modal-content bg-white rounded-2xl shadow-2xl p-8 max-w-4xl w-full max-h-[90vh] overflow-y-auto animate-fade-in"
            >
              <div className="mb-6">
                <h2 className="text-2xl font-bold font-display text-primary mb-2">Compte rendu du projet</h2>
                <div className="bg-gray-50 rounded-lg p-4 mb-6">
                  <h3 className="font-semibold text-dark mb-2">R√©sum√© du projet</h3>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                    <div>
                      <span className="font-medium text-gray-700">Nom :</span> {projet.nom}
                    </div>
                    <div>
                      <span className="font-medium text-gray-700">Statut :</span> 
                      <span className={`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-bold border ml-2 ${STATUTS_PROJET[projet.statut || 'conception']?.color || STATUTS_PROJET['conception'].color}`}>
                        {STATUTS_PROJET[projet.statut || 'conception']?.icon || STATUTS_PROJET['conception'].icon} {STATUTS_PROJET[projet.statut || 'conception']?.label || STATUTS_PROJET['conception'].label}
                      </span>
                    </div>
                    <div>
                      <span className="font-medium text-gray-700">Priorit√© :</span> {projet.priorite}
                    </div>
                    <div>
                      <span className="font-medium text-gray-700">Points estim√©s :</span> {projet.points}
                    </div>
                    {projet.dateDebut && (
                      <div>
                        <span className="font-medium text-gray-700">Date de d√©but :</span> {new Date(projet.dateDebut).toLocaleDateString('fr-FR')}
                      </div>
                    )}
                    {projet.devsAffectesIds && projet.devsAffectesIds.length > 0 && (
                      <div>
                        <span className="font-medium text-gray-700">D√©veloppeurs :</span> {projet.devsAffectesIds.map(id => {
                          const dev = window.devs?.find(d => d.id === id);
                          return dev ? `${dev.prenom} ${dev.nom}` : '';
                        }).filter(Boolean).join(', ')}
                      </div>
                    )}
                  </div>
                </div>
              </div>
              
              <div className="space-y-6">
                <div>
                  <label className="block text-sm font-semibold mb-2 text-gray-700">Date de rendu *</label>
                  <input 
                    type="date" 
                    className="w-full border-2 border-primary/20 rounded-lg px-3 py-2 focus:ring-2 focus:ring-primary/40 transition" 
                    value={dateRendu} 
                    onChange={e => setDateRendu(e.target.value)} 
                    required 
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold mb-2 text-gray-700">R√©sum√© du projet *</label>
                  <textarea 
                    className="w-full border-2 border-primary/20 rounded-lg px-3 py-2 focus:ring-2 focus:ring-primary/40 transition min-h-[100px] resize-y" 
                    value={resume} 
                    onChange={e => setResume(e.target.value)} 
                    placeholder="D√©crivez bri√®vement le projet, ses objectifs et son contexte..." 
                    required 
                  />
                </div>
                
                <div>
                  <label className="block text-sm font-semibold mb-2 text-gray-700">Ce qui a march√© *</label>
                  <textarea 
                    className="w-full border-2 border-primary/20 rounded-lg px-3 py-2 focus:ring-2 focus:ring-primary/40 transition min-h-[100px] resize-y" 
                    value={ceQuiAMarche} 
                    onChange={e => setCeQuiAMarche(e.target.value)} 
                    placeholder="Listez les points positifs, les r√©ussites, les bonnes pratiques..." 
                    required 
                  />
                </div>
                
                <div>
                  <label className="block text-sm font-semibold mb-2 text-gray-700">Ce qui a moins bien march√© *</label>
                  <textarea 
                    className="w-full border-2 border-primary/20 rounded-lg px-3 py-2 focus:ring-2 focus:ring-primary/40 transition min-h-[100px] resize-y" 
                    value={ceQuiAMoinsMarche} 
                    onChange={e => setCeQuiAMoinsMarche(e.target.value)} 
                    placeholder="Identifiez les difficult√©s rencontr√©es, les obstacles..." 
                    required 
                  />
                </div>
                
                <div>
                  <label className="block text-sm font-semibold mb-2 text-gray-700">Ce que l'on doit am√©liorer *</label>
                  <textarea 
                    className="w-full border-2 border-primary/20 rounded-lg px-3 py-2 focus:ring-2 focus:ring-primary/40 transition min-h-[100px] resize-y" 
                    value={ameliorations} 
                    onChange={e => setAmeliorations(e.target.value)} 
                    placeholder="Proposez des am√©liorations, des actions √† mettre en place..." 
                    required 
                  />
                </div>
              </div>
              
              <div className="flex justify-center gap-4 mt-8">
                <button
                  className="px-6 py-3 rounded-lg font-bold text-white bg-green-500 hover:bg-green-600 transition"
                  onClick={handleConfirm}
                >
                  Valider le compte rendu
                </button>
                <button
                  className="px-6 py-3 rounded-lg font-bold text-gray-700 bg-gray-200 hover:bg-gray-300 transition"
                  onClick={onClose}
                >
                  Annuler
                </button>
              </div>
            </div>
          </div>
        );
      }

      // Affichage du planning pr√©visionnel
      function PlanningView({ devs, projects, genererPlanning, setProjects, STATUTS_PROJET, onToggleFini }) {
        const SPRINT_DAYS = 10;
        if (devs.length === 0 || projects.length === 0) {
          return (
            <section className="bg-white/90 p-8 rounded-2xl shadow-magic border border-primary/10 mb-8 transition-all duration-300 hover:shadow-2xl">
              <h2 className="text-2xl font-bold font-display text-primary mb-4 flex items-center gap-2">
                <svg className="w-7 h-7 text-accent" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" d="M12 6v6l4 2" /></svg>
                Planning pr√©visionnel
              </h2>
              <div className="text-gray-400 italic">Ajoutez au moins un d√©veloppeur et un projet pour g√©n√©rer le planning.</div>
            </section>
          );
        }

        const planning = genererPlanning(devs, projects);

        // Associer l'√©tat 'fini' du projet d'origine
        const projectsById = Object.fromEntries(projects.map(p => [p.id, p]));
        const planningWithFini = planning.map(p => ({ ...p, fini: projectsById[p.id]?.fini ?? false }));



        // Fonction pour g√©n√©rer le PDF
        function genererPDF(compteRendu, projet) {
          const { jsPDF } = window.jspdf;
          const doc = new jsPDF();
          
          // Titre
          doc.setFontSize(20);
          doc.setFont('helvetica', 'bold');
          doc.text('Compte Rendu de Projet', 20, 30);
          
          // Informations du projet
          doc.setFontSize(12);
          doc.setFont('helvetica', 'bold');
          doc.text('Informations du projet:', 20, 50);
          doc.setFont('helvetica', 'normal');
          doc.text(`Nom: ${projet.nom}`, 20, 60);
          doc.text(`Priorit√©: ${projet.priorite}`, 20, 70);
          doc.text(`Points estim√©s: ${projet.points}`, 20, 80);
          doc.text(`Date de fin: ${new Date(compteRendu.compteRenduData.dateRendu).toLocaleDateString('fr-FR')}`, 20, 90);
          
          // R√©sum√©
          doc.setFont('helvetica', 'bold');
          doc.text('R√©sum√© du projet:', 20, 110);
          doc.setFont('helvetica', 'normal');
          const resumeLines = doc.splitTextToSize(compteRendu.compteRenduData.resume, 170);
          doc.text(resumeLines, 20, 120);
          
          // Ce qui a march√©
          let yPos = 120 + (resumeLines.length * 7);
          doc.setFont('helvetica', 'bold');
          doc.text('Ce qui a march√©:', 20, yPos);
          doc.setFont('helvetica', 'normal');
          const marcheLines = doc.splitTextToSize(compteRendu.compteRenduData.ceQuiAMarche, 170);
          doc.text(marcheLines, 20, yPos + 10);
          
          // Ce qui a moins bien march√©
          yPos = yPos + 10 + (marcheLines.length * 7);
          doc.setFont('helvetica', 'bold');
          doc.text('Ce qui a moins bien march√©:', 20, yPos);
          doc.setFont('helvetica', 'normal');
          const moinsMarcheLines = doc.splitTextToSize(compteRendu.compteRenduData.ceQuiAMoinsMarche, 170);
          doc.text(moinsMarcheLines, 20, yPos + 10);
          
          // Am√©liorations
          yPos = yPos + 10 + (moinsMarcheLines.length * 7);
          doc.setFont('helvetica', 'bold');
          doc.text('Am√©liorations √† apporter:', 20, yPos);
          doc.setFont('helvetica', 'normal');
          const ameliorationsLines = doc.splitTextToSize(compteRendu.compteRenduData.ameliorations, 170);
          doc.text(ameliorationsLines, 20, yPos + 10);
          
          // T√©l√©charger le PDF
          doc.save(`compte-rendu-${projet.nom.replace(/[^a-zA-Z0-9]/g, '-')}-${new Date().toISOString().split('T')[0]}.pdf`);
        }

        // Calcule la date de fin pr√©visionnelle (statique - calcul√©e √† la cr√©ation)
        function getDateFin(proj) {
          if (!proj.dateDebut) return "-";
          const d = new Date(proj.dateDebut);
          // On consid√®re 1 sprint = SPRINT_DAYS jours ouvr√©s (on ajoute 2 jours par sprint pour simuler les week-ends)
          const totalDays = proj.sprints * (SPRINT_DAYS + 2);
          d.setDate(d.getDate() + totalDays);
          return d.toLocaleDateString('fr-FR');
        }



        function getFinStatusColor(proj) {
          if (proj.fini) return 'bg-green-50';
          // On parse la date de fin pr√©visionnelle
          const dateFinStr = getDateFin(proj);
          if (!dateFinStr || dateFinStr === '-') return '';
          const [jour, mois, annee] = dateFinStr.split('/').map(Number);
          const dateFin = new Date(annee, mois - 1, jour);
          const now = new Date();
          // On ignore l'heure pour la comparaison
          dateFin.setHours(0,0,0,0);
          now.setHours(0,0,0,0);
          const diffJours = Math.ceil((dateFin - now) / (1000 * 60 * 60 * 24));
          if (diffJours < 0) return 'bg-red-50';
          if (diffJours <= 7) return 'bg-orange-50';
          return '';
        }

        // Trie par priorit√© puis date de d√©but
        const planningSorted = [...planningWithFini].sort((a, b) => {
          if (a.priorite !== b.priorite) return a.priorite - b.priorite;
          // Si pas de date, on met √† la fin
          if (!a.dateDebut && b.dateDebut) return 1;
          if (a.dateDebut && !b.dateDebut) return -1;
          if (!a.dateDebut && !b.dateDebut) return 0;
          return new Date(a.dateDebut) - new Date(b.dateDebut);
        });

        // Filtres
        const [filtrePriorite, setFiltrePriorite] = React.useState('');
        const [filtreEtat, setFiltreEtat] = React.useState('');
        const [filtreDev, setFiltreDev] = React.useState('');

        // Helper pour √©tat du projet
        function getEtatProjet(proj) {
          if (proj.fini) return 'livre';
          const dateFinStr = getDateFin(proj);
          if (!dateFinStr || dateFinStr === '-') return 'en_cours';
          const [jour, mois, annee] = dateFinStr.split('/').map(Number);
          const dateFin = new Date(annee, mois - 1, jour);
          const now = new Date();
          dateFin.setHours(0,0,0,0);
          now.setHours(0,0,0,0);
          const diffJours = Math.ceil((dateFin - now) / (1000 * 60 * 60 * 24));
          if (diffJours < 0) return 'retard';
          if (diffJours <= 7) return 'bientot_retard';
          return 'en_cours';
        }

        // Filtrage
        const planningFiltred = planningSorted.filter(proj => {
          if (filtrePriorite && String(proj.priorite) !== filtrePriorite) return false;
          if (filtreEtat) {
            const etat = getEtatProjet(proj);
            if (filtreEtat === 'en_cours' && etat !== 'en_cours') return false;
            if (filtreEtat === 'livre' && etat !== 'livre') return false;
            if (filtreEtat === 'retard' && etat !== 'retard') return false;
            if (filtreEtat === 'bientot_retard' && etat !== 'bientot_retard') return false;
          }
          if (filtreDev) {
            if (!proj.devsAffectesIds || !proj.devsAffectesIds.includes(Number(filtreDev))) return false;
          }
          return true;
        });

        return (
          <section className="bg-white/90 p-8 rounded-2xl shadow-magic border border-primary/10 mb-8 transition-all duration-300 hover:shadow-2xl">
            <h2 className="text-2xl font-bold font-display text-primary mb-4 flex items-center gap-2">
              <svg className="w-8 h-8 text-accent -mt-1" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24">
                <rect x="3" y="7" width="18" height="13" rx="2" stroke="currentColor" strokeWidth="2"/>
                <path strokeLinecap="round" strokeLinejoin="round" d="M16 3v4M8 3v4M3 11h18" />
              </svg>
              Planning pr√©visionnel
            </h2>
            {/* Filtres */}
            <div className="flex flex-wrap gap-4 mb-6 items-end">
              <div>
                <label className="block text-xs font-semibold text-gray-600 mb-1">Priorit√©</label>
                <select className="border-2 border-primary/20 rounded-lg px-3 py-2 focus:ring-2 focus:ring-primary/40 transition bg-white shadow-sm" value={filtrePriorite} onChange={e => setFiltrePriorite(e.target.value)}>
                  <option value="">Toutes</option>
                  {[...new Set(planningSorted.map(p => p.priorite))].sort((a,b)=>a-b).map(prio => (
                    <option key={prio} value={prio}>{prio}</option>
                  ))}
                </select>
              </div>
              <div>
                <label className="block text-xs font-semibold text-gray-600 mb-1">√âtat</label>
                <select className="border-2 border-primary/20 rounded-lg px-3 py-2 focus:ring-2 focus:ring-primary/40 transition bg-white shadow-sm" value={filtreEtat} onChange={e => setFiltreEtat(e.target.value)}>
                  <option value="">Tous</option>
                  <option value="en_cours">En cours</option>
                  <option value="bientot_retard">Bient√¥t en retard</option>
                  <option value="retard">En retard</option>
                  <option value="livre">Livr√©</option>
                </select>
              </div>
              <div>
                <label className="block text-xs font-semibold text-gray-600 mb-1">D√©veloppeur</label>
                <select className="border-2 border-primary/20 rounded-lg px-3 py-2 focus:ring-2 focus:ring-primary/40 transition bg-white shadow-sm" value={filtreDev} onChange={e => setFiltreDev(e.target.value)}>
                  <option value="">Tous</option>
                  {devs.map(dev => (
                    <option key={dev.id} value={dev.id}>{dev.prenom} {dev.nom}</option>
                  ))}
                </select>
              </div>
            </div>
            <div className="overflow-x-auto">
              <table className="min-w-full border-separate border-spacing-0 rounded-2xl shadow-lg bg-white">
                <thead>
                  <tr className="bg-gradient-to-r from-primary/80 to-accent/80 text-white">
                    <th className="px-4 py-3 text-left font-bold rounded-tl-2xl">Projet</th>
                    <th className="px-4 py-3 text-left font-bold">Statut</th>
                    <th className="px-4 py-3 text-left font-bold">Priorit√©</th>
                    <th className="px-4 py-3 text-left font-bold">Points</th>
                    <th className="px-4 py-3 text-left font-bold">Sprints n√©cessaires</th>
                    <th className="px-4 py-3 text-left font-bold">Date de fin pr√©visionnelle</th>
                    <th className="px-4 py-3 text-left font-bold">Devs affect√©s</th>
                    <th className="px-4 py-3 text-left font-bold rounded-tr-2xl">Fini ?</th>
                  </tr>
                </thead>
                <tbody>
                  {planningFiltred.map((proj, idx) => (
                    <tr key={proj.id} className={
                      "transition hover:bg-accent/10 " +
                      (getFinStatusColor(proj) || (idx % 2 === 0 ? "bg-gray-50" : "bg-white"))
                    }>
                      <td className="px-4 py-3 font-semibold text-dark text-base rounded-l-xl border-b border-gray-200">{proj.nom}</td>
                      <td className="px-4 py-3 border-b border-gray-200">
                        <span className={`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-bold border ${STATUTS_PROJET[proj.statut || 'conception']?.color || STATUTS_PROJET['conception'].color}`}>
                          {STATUTS_PROJET[proj.statut || 'conception']?.icon || STATUTS_PROJET['conception'].icon} {STATUTS_PROJET[proj.statut || 'conception']?.label || STATUTS_PROJET['conception'].label}
                        </span>
                      </td>
                      <td className="px-4 py-3 border-b border-gray-200">
                        <span className={"inline-block px-2 py-1 rounded-full text-xs font-bold " +
                          (proj.priorite === 1 ? "bg-primary/90 text-white" :
                          proj.priorite === 2 ? "bg-accent/90 text-white" :
                          "bg-gray-200 text-gray-700")
                        }>
                          {proj.priorite}
                        </span>
                      </td>
                      <td className="px-4 py-3 border-b border-gray-200 text-gray-700 font-medium">{proj.points}</td>
                      <td className="px-4 py-3 border-b border-gray-200 text-gray-700 font-medium">{proj.sprints}</td>
                      <td className="px-4 py-3 border-b border-gray-200 text-gray-700 whitespace-nowrap">{getDateFin(proj)}
  {/* Affichage du retard en jours ou mois si projet en retard */}
  {(() => {
    if (proj.fini) return null;
    const dateFinStr = getDateFin(proj);
    if (!dateFinStr || dateFinStr === '-') return null;
    const [jour, mois, annee] = dateFinStr.split('/').map(Number);
    const dateFin = new Date(annee, mois - 1, jour);
    const now = new Date();
    dateFin.setHours(0,0,0,0);
    now.setHours(0,0,0,0);
    const diffJours = Math.ceil((now - dateFin) / (1000 * 60 * 60 * 24));
    if (diffJours > 0) {
      if (diffJours < 30) {
        return (
          <div className="text-xs text-red-600 font-bold mt-1">{diffJours} jour{diffJours > 1 ? 's' : ''} de retard</div>
        );
      } else {
        const moisRetard = Math.ceil(diffJours / 30);
        return (
          <div className="text-xs text-red-600 font-bold mt-1">{moisRetard} mois de retard</div>
        );
      }
    }
    return null;
  })()}
</td>
                      <td className="px-4 py-3 border-b border-gray-200 text-gray-700">
                        {(() => {
                          // Si le projet a des d√©veloppeurs sp√©cifiquement affect√©s, les afficher
                          if (proj.devsAffectesIds && proj.devsAffectesIds.length > 0) {
                            return devs
                              .filter(dev => proj.devsAffectesIds.includes(dev.id))
                              .map(dev => `${dev.prenom} ${dev.nom}`)
                              .join(", ");
                          }
                          // Sinon, afficher tous les d√©veloppeurs (comportement par d√©faut)
                          return devs.map(dev => `${dev.prenom} ${dev.nom}`).join(", ");
                        })()}
                      </td>
                      <td className="px-4 py-3 border-b border-gray-200 rounded-r-xl">
                        {proj.fini ? (
                          <span className="inline-block px-3 py-1 rounded-full bg-green-600/90 text-white text-xs font-bold">Livr√©</span>
                        ) : (
                          <button
                            className={
                              "px-3 py-1 rounded-full text-xs font-bold border-2 transition " +
                              "border-accent text-accent bg-accent/10 hover:bg-accent/20"
                            }
                            onClick={() => onToggleFini(proj.id)}
                          >
                            Fini ?
                          </button>
                        )}
                      </td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
            <div className="text-xs text-gray-500 mt-2">* 1 sprint de marge est ajout√© automatiquement √† chaque projet.</div>
          </section>
        );
      }

      // Composant Compte Rendu de Projet
      function CompteRenduProjet({ projects, devs, STATUTS_PROJET, onCompteRenduAdded }) {
        const [compteRendus, setCompteRendus] = React.useState(() => {
          try {
            return JSON.parse(localStorage.getItem('compteRendus')) || [];
          } catch {
            return [];
          }
        });
        const [forceUpdate, setForceUpdate] = React.useState(0);

        // Sauvegarde automatique
        React.useEffect(() => {
          localStorage.setItem('compteRendus', JSON.stringify(compteRendus));
        }, [compteRendus]);

        // Fonction pour ajouter un compte rendu depuis l'ext√©rieur
        React.useEffect(() => {
          if (onCompteRenduAdded) {
            // Cr√©er une fonction qui peut √™tre appel√©e depuis l'ext√©rieur
            window.addCompteRendu = (nouveauCompteRendu) => {
              setCompteRendus(prev => [...prev, nouveauCompteRendu]);
              setForceUpdate(prev => prev + 1);
            };
          }
        }, [onCompteRenduAdded]);

        const [selectedProject, setSelectedProject] = React.useState("");
        const [titre, setTitre] = React.useState("");
        const [contenu, setContenu] = React.useState("");
        const [date, setDate] = React.useState(new Date().toISOString().split('T')[0]);
        const [type, setType] = React.useState("reunion");
        const [editMode, setEditMode] = React.useState(false);
        const [editId, setEditId] = React.useState(null);

        const TYPES_COMPTE_RENDU = {
          'reunion': { color: 'bg-blue-100 text-blue-800 border-blue-200', icon: 'üìã', label: 'R√©union' },
          'avancement': { color: 'bg-green-100 text-green-800 border-green-200', icon: 'üìà', label: 'Avancement' },
          'probleme': { color: 'bg-red-100 text-red-800 border-red-200', icon: '‚ö†Ô∏è', label: 'Probl√®me' },
          'decision': { color: 'bg-purple-100 text-purple-800 border-purple-200', icon: 'üéØ', label: 'D√©cision' },
          'livraison': { color: 'bg-orange-100 text-orange-800 border-orange-200', icon: 'üöÄ', label: 'Livraison' }
        };

        function handleSubmit(e) {
          e.preventDefault();
          if (!selectedProject || !titre.trim() || !contenu.trim()) return;

          const selectedProj = projects.find(p => p.id === Number(selectedProject));
          
          if (editMode && editId !== null) {
            setCompteRendus(prev => prev.map(cr =>
              cr.id === editId
                ? {
                    ...cr,
                    projetId: Number(selectedProject),
                    projetNom: selectedProj.nom,
                    titre: titre.trim(),
                    contenu: contenu.trim(),
                    date,
                    type
                  }
                : cr
            ));
            setEditMode(false);
            setEditId(null);
          } else {
            setCompteRendus(prev => [
              ...prev,
              {
                id: Date.now(),
                projetId: Number(selectedProject),
                projetNom: selectedProj.nom,
                titre: titre.trim(),
                contenu: contenu.trim(),
                date,
                type
              }
            ]);
          }

          setSelectedProject("");
          setTitre("");
          setContenu("");
          setDate(new Date().toISOString().split('T')[0]);
          setType("reunion");
        }

        function handleEdit(cr) {
          setSelectedProject(cr.projetId.toString());
          setTitre(cr.titre);
          setContenu(cr.contenu);
          setDate(cr.date);
          setType(cr.type);
          setEditMode(true);
          setEditId(cr.id);
        }

        function handleSubmit(e) {
          e.preventDefault();
          if (!selectedProject || !titre.trim() || !contenu.trim()) return;

          const selectedProj = projects.find(p => p.id === Number(selectedProject));
          
          if (editMode && editId !== null) {
            setCompteRendus(prev => prev.map(cr =>
              cr.id === editId
                ? {
                    ...cr,
                    projetId: Number(selectedProject),
                    projetNom: selectedProj.nom,
                    titre: titre.trim(),
                    contenu: contenu.trim(),
                    date,
                    type
                  }
                : cr
            ));
            setEditMode(false);
            setEditId(null);
          } else {
            setCompteRendus(prev => [
              ...prev,
              {
                id: Date.now(),
                projetId: Number(selectedProject),
                projetNom: selectedProj.nom,
                titre: titre.trim(),
                contenu: contenu.trim(),
                date,
                type
              }
            ]);
          }

          setSelectedProject("");
          setTitre("");
          setContenu("");
          setDate(new Date().toISOString().split('T')[0]);
          setType("reunion");
        }

        function handleCancelEdit() {
          setEditMode(false);
          setEditId(null);
          setSelectedProject("");
          setTitre("");
          setContenu("");
          setDate(new Date().toISOString().split('T')[0]);
          setType("reunion");
        }

        function handleDelete(crId) {
          if (window.confirm('Supprimer ce compte rendu ?')) {
            setCompteRendus(prev => prev.filter(cr => cr.id !== crId));
            if (editId === crId) {
              handleCancelEdit();
            }
          }
        }

        function formatDateFR(dateStr) {
          if (!dateStr) return "-";
          try {
            return new Date(dateStr).toLocaleDateString('fr-FR');
          } catch {
            return dateStr;
          }
        }

        // Tri par date d√©croissante
        const compteRendusTries = [...compteRendus].sort((a, b) => new Date(b.date) - new Date(a.date));

        // Fonction pour t√©l√©charger le PDF d'un compte rendu existant
        function telechargerPDF(compteRendu) {
          if (!compteRendu.isCompteRenduFinal || !compteRendu.compteRenduData) {
            alert("Ce compte rendu n'est pas un compte rendu final ou ne contient pas les donn√©es n√©cessaires.");
            return;
          }

          const { jsPDF } = window.jspdf;
          const doc = new jsPDF();
          
          // Titre
          doc.setFontSize(20);
          doc.setFont('helvetica', 'bold');
          doc.text('Compte Rendu de Projet', 20, 30);
          
          // Informations du projet
          doc.setFontSize(12);
          doc.setFont('helvetica', 'bold');
          doc.text('Informations du projet:', 20, 50);
          doc.setFont('helvetica', 'normal');
          doc.text(`Nom: ${compteRendu.projetNom}`, 20, 60);
          doc.text(`Date de fin: ${formatDateFR(compteRendu.compteRenduData.dateRendu)}`, 20, 70);
          
          // R√©sum√©
          doc.setFont('helvetica', 'bold');
          doc.text('R√©sum√© du projet:', 20, 90);
          doc.setFont('helvetica', 'normal');
          const resumeLines = doc.splitTextToSize(compteRendu.compteRenduData.resume, 170);
          doc.text(resumeLines, 20, 100);
          
          // Ce qui a march√©
          let yPos = 100 + (resumeLines.length * 7);
          doc.setFont('helvetica', 'bold');
          doc.text('Ce qui a march√©:', 20, yPos);
          doc.setFont('helvetica', 'normal');
          const marcheLines = doc.splitTextToSize(compteRendu.compteRenduData.ceQuiAMarche, 170);
          doc.text(marcheLines, 20, yPos + 10);
          
          // Ce qui a moins bien march√©
          yPos = yPos + 10 + (marcheLines.length * 7);
          doc.setFont('helvetica', 'bold');
          doc.text('Ce qui a moins bien march√©:', 20, yPos);
          doc.setFont('helvetica', 'normal');
          const moinsMarcheLines = doc.splitTextToSize(compteRendu.compteRenduData.ceQuiAMoinsMarche, 170);
          doc.text(moinsMarcheLines, 20, yPos + 10);
          
          // Am√©liorations
          yPos = yPos + 10 + (moinsMarcheLines.length * 7);
          doc.setFont('helvetica', 'bold');
          doc.text('Am√©liorations √† apporter:', 20, yPos);
          doc.setFont('helvetica', 'normal');
          const ameliorationsLines = doc.splitTextToSize(compteRendu.compteRenduData.ameliorations, 170);
          doc.text(ameliorationsLines, 20, yPos + 10);
          
          // T√©l√©charger le PDF
          doc.save(`compte-rendu-${compteRendu.projetNom.replace(/[^a-zA-Z0-9]/g, '-')}-${compteRendu.date}.pdf`);
        }

        return (
          <section className="bg-white/90 p-8 rounded-2xl shadow-magic border border-primary/10 mb-8 transition-all duration-300 hover:shadow-2xl">
            <h2 className="text-2xl font-bold font-display text-primary mb-4 flex items-center gap-2">
              <svg className="w-7 h-7 text-accent" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>
              Compte rendu de projet
            </h2>
            
            <div>
              <h3 className="font-semibold mb-4 text-gray-700">Cr√©er un nouveau compte rendu</h3>
              <form className="space-y-6 mb-8" onSubmit={handleSubmit}>
                <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                  <div>
                    <label className="block text-sm font-semibold mb-2 text-gray-700">Projet</label>
                    <select 
                      className="w-full border-2 border-primary/20 rounded-lg px-4 py-3 focus:ring-2 focus:ring-primary/40 transition text-base" 
                      value={selectedProject} 
                      onChange={e => setSelectedProject(e.target.value)} 
                      required
                    >
                      <option value="">Choisir un projet‚Ä¶</option>
                      {projects.map(proj => (
                        <option key={proj.id} value={proj.id}>{proj.nom}</option>
                      ))}
                    </select>
                  </div>
                  <div>
                    <label className="block text-sm font-semibold mb-2 text-gray-700">Type</label>
                    <select 
                      className="w-full border-2 border-primary/20 rounded-lg px-4 py-3 focus:ring-2 focus:ring-primary/40 transition text-base" 
                      value={type} 
                      onChange={e => setType(e.target.value)} 
                      required
                    >
                      {Object.keys(TYPES_COMPTE_RENDU).map(t => (
                        <option key={t} value={t}>
                          {TYPES_COMPTE_RENDU[t].icon} {TYPES_COMPTE_RENDU[t].label}
                        </option>
                      ))}
                    </select>
                  </div>
                  <div>
                    <label className="block text-sm font-semibold mb-2 text-gray-700">Date</label>
                    <input 
                      type="date" 
                      className="w-full border-2 border-primary/20 rounded-lg px-4 py-3 focus:ring-2 focus:ring-primary/40 transition text-base" 
                      value={date} 
                      onChange={e => setDate(e.target.value)} 
                      required 
                    />
                  </div>
                  <div className="flex flex-col sm:flex-row gap-2 items-end">
                    <button 
                      type="submit" 
                      className={"w-full sm:w-auto px-6 py-3 rounded-lg font-bold text-white shadow transition-all duration-200 text-base " + 
                        (editMode ? "bg-primary hover:bg-primary/90" : "bg-accent hover:bg-accent/80")
                      }
                    >
                      {editMode ? "Modifier" : "Cr√©er"}
                    </button>
                    {editMode && (
                      <button 
                        type="button" 
                        className="w-full sm:w-auto px-4 py-3 rounded-lg font-semibold bg-gray-200 hover:bg-gray-300 text-gray-700 transition text-base" 
                        onClick={handleCancelEdit}
                      >
                        Annuler
                      </button>
                    )}
                  </div>
                </div>
                <div>
                  <label className="block text-sm font-semibold mb-2 text-gray-700">Titre</label>
                  <input 
                    type="text" 
                    className="w-full border-2 border-primary/20 rounded-lg px-4 py-3 focus:ring-2 focus:ring-primary/40 transition text-base" 
                    value={titre} 
                    onChange={e => setTitre(e.target.value)} 
                    placeholder="Titre du compte rendu..." 
                    required 
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold mb-2 text-gray-700">Contenu</label>
                  <textarea 
                    className="w-full border-2 border-primary/20 rounded-lg px-4 py-3 focus:ring-2 focus:ring-primary/40 transition min-h-[200px] resize-y text-base leading-relaxed" 
                    value={contenu} 
                    onChange={e => setContenu(e.target.value)} 
                    placeholder="D√©tails du compte rendu..." 
                    required 
                    style={{ lineHeight: '1.6' }}
                  />
                </div>
              </form>

              <h3 className="font-semibold mb-4 text-gray-700">Comptes rendus existants</h3>
              {compteRendusTries.length === 0 ? (
                <div className="text-gray-400 italic">Aucun compte rendu cr√©√©.</div>
              ) : (
                <div className="space-y-4">
                  {compteRendusTries.map(cr => (
                    <div key={cr.id} className="border border-gray-200 rounded-lg p-4 hover:shadow-md transition">
                      <div className="flex items-start justify-between mb-2">
                        <div className="flex items-center gap-2">
                          <span className={`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-bold border ${TYPES_COMPTE_RENDU[cr.type]?.color || TYPES_COMPTE_RENDU['reunion'].color}`}>
                            {TYPES_COMPTE_RENDU[cr.type]?.icon || TYPES_COMPTE_RENDU['reunion'].icon} {TYPES_COMPTE_RENDU[cr.type]?.label || TYPES_COMPTE_RENDU['reunion'].label}
                          </span>
                          <span className="text-sm text-gray-500">{formatDateFR(cr.date)}</span>
                          {cr.isCompteRenduFinal && (
                            <span className="inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-bold bg-green-100 text-green-800 border-green-200">
                              üèÅ Compte rendu final
                            </span>
                          )}
                        </div>
                        <div className="flex gap-2">
                          {cr.isCompteRenduFinal && (
                            <button 
                              type="button" 
                              className="text-green-600 hover:text-green-800 font-bold opacity-70 hover:opacity-100 transition" 
                              title="T√©l√©charger PDF" 
                              onClick={() => telechargerPDF(cr)}
                            >
                              <svg className="w-5 h-5" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24">
                                <path strokeLinecap="round" strokeLinejoin="round" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                              </svg>
                            </button>
                          )}
                          <button 
                            type="button" 
                            className="text-accent hover:text-primary font-bold opacity-70 hover:opacity-100 transition" 
                            title="Modifier" 
                            onClick={() => handleEdit(cr)}
                          >
                            <svg className="w-5 h-5" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24">
                              <path strokeLinecap="round" strokeLinejoin="round" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                            </svg>
                          </button>
                          <button 
                            type="button" 
                            className="text-red-400 hover:text-red-600 font-bold opacity-70 hover:opacity-100 transition" 
                            title="Supprimer" 
                            onClick={() => handleDelete(cr.id)}
                          >
                            <svg className="w-5 h-5" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24">
                              <path strokeLinecap="round" strokeLinejoin="round" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                          </button>
                        </div>
                      </div>
                      <h4 className="font-semibold text-dark mb-1">{cr.titre}</h4>
                      <p className="text-sm text-gray-600 mb-2">Projet : <span className="font-medium text-primary">{cr.projetNom}</span></p>
                      <div className="text-sm text-gray-700 whitespace-pre-wrap leading-relaxed" style={{ lineHeight: '1.6' }}>{cr.contenu}</div>
                    </div>
                  ))}
                </div>
              )}
            </div>
          </section>
        );
      }

      // Nouveau composant SprintCalendar avec interface calendrier moderne
      function SprintCalendar({ sprints, setSprints }) {
        const [numero, setNumero] = React.useState("");
        const [dateDebut, setDateDebut] = React.useState("");
        const [dateFin, setDateFin] = React.useState("");
        const [editMode, setEditMode] = React.useState(false);
        const [editId, setEditId] = React.useState(null);
        const [currentMonth, setCurrentMonth] = React.useState(new Date());
        const [showForm, setShowForm] = React.useState(false);

        // Couleurs pour les sprints
        const sprintColors = [
          'bg-gradient-to-r from-blue-500 to-blue-600',
          'bg-gradient-to-r from-purple-500 to-purple-600',
          'bg-gradient-to-r from-green-500 to-green-600',
          'bg-gradient-to-r from-orange-500 to-orange-600',
          'bg-gradient-to-r from-pink-500 to-pink-600',
          'bg-gradient-to-r from-indigo-500 to-indigo-600',
          'bg-gradient-to-r from-teal-500 to-teal-600',
          'bg-gradient-to-r from-red-500 to-red-600',
          'bg-gradient-to-r from-yellow-500 to-yellow-600',
          'bg-gradient-to-r from-cyan-500 to-cyan-600'
        ];

        function handleSubmit(e) {
          e.preventDefault();
          if (!numero || !dateDebut || !dateFin) return;
          if (editMode && editId !== null) {
            setSprints(sprints => sprints.map(s =>
              s.id === editId
                ? { ...s, numero: Number(numero), dateDebut, dateFin }
                : s
            ));
            setEditMode(false);
            setEditId(null);
          } else {
            setSprints(sprints => [
              ...sprints,
              {
                id: Date.now(),
                numero: Number(numero),
                dateDebut,
                dateFin,
              },
            ]);
          }
          setNumero("");
          setDateDebut("");
          setDateFin("");
          setShowForm(false);
        }

        function handleEdit(sprint) {
          setNumero(sprint.numero);
          setDateDebut(sprint.dateDebut);
          setDateFin(sprint.dateFin);
          setEditMode(true);
          setEditId(sprint.id);
          setShowForm(true);
        }

        function handleCancelEdit() {
          setEditMode(false);
          setEditId(null);
          setNumero("");
          setDateDebut("");
          setDateFin("");
          setShowForm(false);
        }

        function handleDelete(id) {
          if (window.confirm('Supprimer ce sprint ?')) {
            setSprints(sprints => sprints.filter(s => s.id !== id));
            if (editId === id) {
              setEditMode(false);
              setEditId(null);
              setNumero("");
              setDateDebut("");
              setDateFin("");
              setShowForm(false);
            }
          }
        }

        // Tri par num√©ro croissant
        const sprintsTries = [...sprints].sort((a, b) => a.numero - b.numero);

        function formatDateFR(dateStr) {
          if (!dateStr) return "-";
          try {
            return new Date(dateStr).toLocaleDateString('fr-FR');
          } catch {
            return dateStr;
          }
        }

        // Fonctions pour le calendrier
        function getDaysInMonth(date) {
          return new Date(date.getFullYear(), date.getMonth() + 1, 0).getDate();
        }

        function getFirstDayOfMonth(date) {
          return new Date(date.getFullYear(), date.getMonth(), 1).getDay();
        }

        function getSprintForDate(date) {
          const dateStr = date.toISOString().split('T')[0];
          return sprintsTries.find(sprint => {
            const start = new Date(sprint.dateDebut);
            const end = new Date(sprint.dateFin);
            const current = new Date(dateStr);
            return current >= start && current <= end;
          });
        }

        function getSprintColor(sprintNumero) {
          return sprintColors[(sprintNumero - 1) % sprintColors.length];
        }

        function navigateMonth(direction) {
          setCurrentMonth(prev => {
            const newDate = new Date(prev);
            newDate.setMonth(newDate.getMonth() + direction);
            return newDate;
          });
        }

        function generateCalendarDays() {
          const daysInMonth = getDaysInMonth(currentMonth);
          const firstDay = getFirstDayOfMonth(currentMonth);
          const days = [];

          // Jours du mois pr√©c√©dent
          for (let i = 0; i < firstDay; i++) {
            const prevMonth = new Date(currentMonth.getFullYear(), currentMonth.getMonth() - 1, 0);
            const day = prevMonth.getDate() - firstDay + i + 1;
            days.push({ day, isCurrentMonth: false, date: new Date(prevMonth.getFullYear(), prevMonth.getMonth(), day) });
          }

          // Jours du mois actuel
          for (let day = 1; day <= daysInMonth; day++) {
            const date = new Date(currentMonth.getFullYear(), currentMonth.getMonth(), day);
            days.push({ day, isCurrentMonth: true, date });
          }

          // Jours du mois suivant
          const remainingDays = 42 - days.length; // 6 semaines * 7 jours
          for (let day = 1; day <= remainingDays; day++) {
            const nextMonth = new Date(currentMonth.getFullYear(), currentMonth.getMonth() + 1, day);
            days.push({ day, isCurrentMonth: false, date: nextMonth });
          }

          return days;
        }

        const calendarDays = generateCalendarDays();
        const monthNames = [
          'Janvier', 'F√©vrier', 'Mars', 'Avril', 'Mai', 'Juin',
          'Juillet', 'Ao√ªt', 'Septembre', 'Octobre', 'Novembre', 'D√©cembre'
        ];

        return (
          <section className="bg-white/90 p-8 rounded-2xl shadow-magic border border-accent/20 mb-8 transition-all duration-300 hover:shadow-xl">
            <div className="flex items-center justify-between mb-6">
              <h2 className="text-2xl font-bold font-display text-accent flex items-center gap-2">
                <svg className="w-7 h-7 text-primary" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24">
                  <rect x="3" y="7" width="18" height="13" rx="2" stroke="currentColor" strokeWidth="2"/>
                  <path strokeLinecap="round" strokeLinejoin="round" d="M16 3v4M8 3v4M3 11h18" />
                </svg>
                Calendrier des Sprints
              </h2>
              <button
                onClick={() => setShowForm(!showForm)}
                className="px-4 py-2 bg-accent hover:bg-accent/80 text-white rounded-lg font-semibold transition-all duration-200 flex items-center gap-2"
              >
                <svg className="w-5 h-5" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                </svg>
                {showForm ? 'Masquer' : 'Ajouter Sprint'}
              </button>
            </div>

            {/* Formulaire d'ajout/modification */}
            {showForm && (
              <div className="mb-6 p-6 bg-gradient-to-r from-accent/10 to-primary/10 rounded-xl border border-accent/20">
                <h3 className="text-lg font-semibold text-dark mb-4">
                  {editMode ? 'Modifier le Sprint' : 'Nouveau Sprint'}
                </h3>
                <form className="flex flex-col md:flex-row md:items-end gap-4" onSubmit={handleSubmit}>
                  <div>
                    <label className="block text-sm font-semibold mb-1 text-gray-700">N¬∞ Sprint</label>
                    <input type="number" min="1" className="w-24 border-2 border-accent/20 rounded-lg px-3 py-2 focus:ring-2 focus:ring-accent/40 transition h-10" value={numero} onChange={e => setNumero(e.target.value)} required />
                  </div>
                  <div>
                    <label className="block text-sm font-semibold mb-1 text-gray-700">Date d√©but</label>
                    <input type="date" className="w-44 border-2 border-accent/20 rounded-lg px-3 py-2 focus:ring-2 focus:ring-accent/40 transition h-10" value={dateDebut} onChange={e => setDateDebut(e.target.value)} required />
                  </div>
                  <div>
                    <label className="block text-sm font-semibold mb-1 text-gray-700">Date fin</label>
                    <input type="date" className="w-44 border-2 border-accent/20 rounded-lg px-3 py-2 focus:ring-2 focus:ring-accent/40 transition h-10" value={dateFin} onChange={e => setDateFin(e.target.value)} required />
                  </div>
                  <button type="submit" className={"px-5 py-2 rounded-lg font-bold text-white shadow transition-all duration-200 " + (editMode ? "bg-primary hover:bg-primary/90" : "bg-accent hover:bg-accent/80")}>
                    {editMode ? "Modifier" : "Ajouter"}
                  </button>
                  {editMode && (
                    <button type="button" className="ml-2 px-4 py-2 rounded-lg font-semibold bg-gray-200 hover:bg-gray-300 text-gray-700 transition" onClick={handleCancelEdit}>
                      Annuler
                    </button>
                  )}
                </form>
              </div>
            )}

            {/* Calendrier */}
            <div className="bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden">
              {/* En-t√™te du calendrier */}
              <div className="bg-gradient-to-r from-primary to-accent text-white p-4">
                <div className="flex items-center justify-between">
                  <button
                    onClick={() => navigateMonth(-1)}
                    className="p-2 hover:bg-white/20 rounded-lg transition-all duration-200"
                  >
                    <svg className="w-6 h-6" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" d="M15 19l-7-7 7-7" />
                    </svg>
                  </button>
                  <h3 className="text-xl font-bold">
                    {monthNames[currentMonth.getMonth()]} {currentMonth.getFullYear()}
                  </h3>
                  <button
                    onClick={() => navigateMonth(1)}
                    className="p-2 hover:bg-white/20 rounded-lg transition-all duration-200"
                  >
                    <svg className="w-6 h-6" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" d="M9 5l7 7-7 7" />
                    </svg>
                  </button>
                </div>
              </div>

              {/* Grille du calendrier */}
              <div className="grid grid-cols-7 gap-px bg-gray-200">
                {/* Jours de la semaine */}
                {['Dim', 'Lun', 'Mar', 'Mer', 'Jeu', 'Ven', 'Sam'].map(day => (
                  <div key={day} className="bg-gray-50 p-3 text-center font-semibold text-gray-700 text-sm">
                    {day}
                  </div>
                ))}

                {/* Jours du mois */}
                {calendarDays.map(({ day, isCurrentMonth, date }, index) => {
                  const sprint = getSprintForDate(date);
                  const isToday = date.toDateString() === new Date().toDateString();
                  
                  return (
                    <div
                      key={index}
                      className={`min-h-[80px] p-2 relative ${
                        isCurrentMonth ? 'bg-white' : 'bg-gray-50'
                      } ${isToday ? 'ring-2 ring-accent ring-opacity-50' : ''}`}
                    >
                      <div className={`text-sm font-medium ${
                        isCurrentMonth ? 'text-gray-900' : 'text-gray-400'
                      } ${isToday ? 'text-accent font-bold' : ''}`}>
                        {day}
                      </div>
                      
                      {sprint && (
                        <div className={`mt-1 p-1 rounded text-xs font-semibold text-white shadow-sm ${getSprintColor(sprint.numero)}`}>
                          Sprint {sprint.numero}
                        </div>
                      )}
                    </div>
                  );
                })}
              </div>
            </div>

            {/* L√©gende des sprints */}
            {sprintsTries.length > 0 && (
              <div className="mt-6">
                <h3 className="font-semibold mb-3 text-gray-700">L√©gende des Sprints</h3>
                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
                  {sprintsTries.map(sprint => (
                    <div key={sprint.id} className="flex items-center justify-between p-3 bg-gray-50 rounded-lg border border-gray-200 group hover:shadow-md transition-all duration-200">
                      <div className="flex items-center gap-3">
                        <div className={`w-4 h-4 rounded-full ${getSprintColor(sprint.numero)}`}></div>
                        <div>
                          <div className="font-semibold text-dark">Sprint {sprint.numero}</div>
                          <div className="text-sm text-gray-600">{formatDateFR(sprint.dateDebut)} ‚Üí {formatDateFR(sprint.dateFin)}</div>
                        </div>
                      </div>
                      <div className="flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity">
                        <button
                          type="button"
                          className="p-1 text-accent hover:text-primary transition"
                          title="Modifier"
                          onClick={() => handleEdit(sprint)}
                        >
                          <svg className="w-4 h-4" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24">
                            <path strokeLinecap="round" strokeLinejoin="round" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                          </svg>
                        </button>
                        <button
                          type="button"
                          className="p-1 text-red-400 hover:text-red-600 transition"
                          title="Supprimer"
                          onClick={() => handleDelete(sprint.id)}
                        >
                          <svg className="w-4 h-4" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24">
                            <path strokeLinecap="round" strokeLinejoin="round" d="M6 18L18 6M6 6l12 12" />
                          </svg>
                        </button>
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            )}

            {sprintsTries.length === 0 && (
              <div className="text-center py-8 text-gray-400">
                <svg className="w-16 h-16 mx-auto mb-4 text-gray-300" fill="none" stroke="currentColor" strokeWidth="1" viewBox="0 0 24 24">
                  <rect x="3" y="7" width="18" height="13" rx="2" stroke="currentColor" strokeWidth="2"/>
                  <path strokeLinecap="round" strokeLinejoin="round" d="M16 3v4M8 3v4M3 11h18" />
                </svg>
                <p className="text-lg font-medium">Aucun sprint configur√©</p>
                <p className="text-sm">Ajoutez votre premier sprint pour commencer !</p>
              </div>
            )}
          </section>
        );
      }

      // Rendu principal
      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
  </body>
</html> 